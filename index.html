<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinWise F11 Master Dashboard</title>
    <style>
        :root {
            --sidebar-bg: #332590;
            --active-accent: #667eea;
            --text-light: #f0f2f5;
        }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar Styles */
        .sidebar { width: 260px; background: var(--sidebar-bg); color: white; display: flex; flex-direction: column; padding: 20px; box-shadow: 4px 0 10px rgba(0,0,0,0.1); }
        .sidebar h2 { font-size: 22px; margin-bottom: 30px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; }
        .nav-btn { background: none; border: none; color: white; text-align: left; padding: 15px; font-size: 16px; cursor: pointer; border-radius: 8px; margin-bottom: 5px; transition: 0.3s; }
        .nav-btn:hover, .nav-btn.active { background: var(--active-accent); }
        
        /* Main Content Area */
        .main-content { flex-grow: 1; display: flex; flex-direction: column; background: #f4f4f4; }
        .top-bar { height: 60px; background: white; display: flex; align-items: center; justify-content: flex-end; padding: 0 30px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        iframe { width: 100%; height: 100%; border: none; flex-grow: 1; }
        
        /* Embedded Behavior Wheel (Initial View) */
        #wheel-view { padding: 40px; display: flex; flex-direction: column; align-items: center; overflow-y: auto; }
    </style>
</head>
<body>

    <nav class="sidebar">
        <h2>FinWise F11</h2>
        <button class="nav-btn active" onclick="loadPage('profile')">ðŸ“Š 1. Profile (Manage)</button>
        <button class="nav-btn" onclick="loadPage('market')">ðŸ“ˆ 2. Live Market (Earn)</button>
        <button class="nav-btn" onclick="loadPage('impact')">ðŸŒ± 3. Social Impact (Grow)</button>
        <button class="nav-btn" onclick="loadPage('subs')">ðŸ’³ Subscription & Pay</button>
        <button class="nav-btn" onclick="loadPage('chat')">ðŸ’¬ 24/7 Consumer Chat</button>
        <div style="margin-top: auto;">
            <p id="userStatus" style="font-size: 12px; opacity: 0.7;">Checking Auth...</p>
            <button class="nav-btn" style="width: 100%;" onclick="handleLogout()">Sign Out</button>
        </div>
    </nav>

    <main class="main-content">
        <div class="top-bar">
            <span id="biasDisplay" style="font-weight: bold; color: var(--sidebar-bg);">Bias: Not Set</span>
        </div>
        <div id="content-frame" style="height: 100%; display: flex; flex-direction: column;">
            <iframe id="app-viewport" src="https://anusin1805.github.io/F11FinWiseBehaviorFinanceProfiling/"></iframe>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "brave-calling.firebaseapp.com",
            projectId: "brave-calling",
            storageBucket: "brave-calling.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // UI Logic
        window.loadPage = function(page) {
            const viewport = document.getElementById('app-viewport');
            const btns = document.querySelectorAll('.nav-btn');
            btns.forEach(b => b.classList.remove('active'));
            
            if(page === 'profile') viewport.src = "https://anusin1805.github.io/F11FinWiseBehaviorFinanceProfiling/";
            if(page === 'market') viewport.src = "https://reinvestmentpoint-ms7xuznw25ojwy4zgw2sxk.streamlit.app/";
            if(page === 'impact') viewport.src = "https://anusin1805.github.io/financeF11bot/";
            if(page === 'subs') viewport.src = "https://anusin1805.github.io/InvestmentPoint/";
            if(page === 'chat') viewport.src = "https://vc-chat-box.onrender.com/";
        }

        // Auth Guardian: Syncs the Bias to the Dashboard Header
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                document.getElementById('userStatus').innerText = `Logged in: ${user.email}`;
                const userDoc = await getDoc(doc(db, "users", user.uid));
                if (userDoc.exists()) {
                    document.getElementById('biasDisplay').innerText = `Bias Detected: ${userDoc.data().bias}`;
                }
            } else {
                window.location.href = "https://anusin1805.github.io/F11EcosystemSubs-login/";
            }
        });

        window.handleLogout = () => signOut(auth);
    </script>
</body>
</html>
